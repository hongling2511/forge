#!/usr/bin/env bash
#
# forge - Engineering scaffold CLI
#
# Usage:
#   forge [command] [options]
#
# Commands:
#   new         Create a new project from template
#   templates   List available templates
#
# Options:
#   -h, --help     Show this help message
#   -v, --version  Show version information
#

set -euo pipefail

# Determine script directory
FORGE_HOME="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
FORGE_VERSION="1.0.0-SNAPSHOT"

# Source libraries
source "${FORGE_HOME}/cli/lib/args.sh"
source "${FORGE_HOME}/cli/lib/validation.sh"

# Show help message
show_help() {
    cat << EOF
forge - Engineering scaffold CLI

Usage:
  forge [command] [options]

Commands:
  new         Create a new project from template
  templates   List available templates

Options:
  -h, --help     Show this help message
  -v, --version  Show version information

Examples:
  forge new -t java-ddd -g com.example -a my-service
  forge templates

For more information about a command:
  forge [command] --help
EOF
}

# Show version
show_version() {
    echo "forge version ${FORGE_VERSION}"
}

# Main entry point
main() {
    if [[ $# -eq 0 ]]; then
        show_help
        exit 0
    fi

    case "${1:-}" in
        -h|--help)
            show_help
            exit 0
            ;;
        -v|--version)
            show_version
            exit 0
            ;;
        new)
            shift
            source "${FORGE_HOME}/cli/commands/new.sh"
            cmd_new "$@"
            ;;
        templates)
            shift
            source "${FORGE_HOME}/cli/commands/templates.sh"
            cmd_templates "$@"
            ;;
        *)
            echo "Error: Unknown command '${1}'" >&2
            echo "Run 'forge --help' for usage information." >&2
            exit 1
            ;;
    esac
}

main "$@"
